[providers.gh.aliases]

# List PRs with author + headRefName -> baseRefName + updatedAt + title
# (Multiline TOML strings are collapsed into a single-line command before install.)
dw_prs = """
pr list
  --limit 50
  --json author,headRefName,baseRefName,updatedAt,title
  --template '{{range .}}{{printf "%-16s %s -> %s  %s  %s\n" .author.login .headRefName .baseRefName .updatedAt .title}}{{end}}'
"""

# Detailed PR view with author + headRefName -> baseRefName + mergeable + reviewDecision + statusCheckRollup + url
dw_prmeta = """
pr view
  --json author,headRefName,baseRefName,mergeable,reviewDecision,statusCheckRollup,url
  --template '{{printf "Author: %s\nBranch: %s -> %s\nMergeable: %s\nReview: %s\nChecks: %v\nURL: %s\n" .author.login .headRefName .baseRefName .mergeable .reviewDecision .statusCheckRollup.state .url}}'
"""

# Open PR in browser
dw_prweb = "pr view --web"

# Checkout PR
dw_prco = "pr checkout"

# Interactive PR picker (fzf). Cancel exits 0.
dw_prf = '''
!sh -c '
command -v gh >/dev/null 2>&1 || { echo "dotwrap: gh not found" >&2; exit 1; };
command -v fzf >/dev/null 2>&1 || { echo "dotwrap: fzf not found" >&2; exit 1; };
sel=$(gh pr list --limit 100 --json number,title,author,headRefName,baseRefName,updatedAt --template "{{range .}}{{printf \"%v\\t%v\\t%v -> %v\\t%v\\t%v\\n\" .number .author.login .headRefName .baseRefName .updatedAt .title}}{{end}}" | fzf --delimiter "\\t" --with-nth=2.. --height 80% --reverse --border --prompt "PR> " --header "enter=open  ctrl-o=checkout  esc=quit" --preview "gh pr view {1} --comments" --expect=enter,ctrl-o);
rc=$?;
[ $rc -ne 0 ] && exit 0;
printf "%s\\n" "$sel" | { IFS= read -r key || exit 0; IFS= read -r line || exit 0; [ -z "$line" ] && exit 0; num=$(printf "%s" "$line" | cut -f1); if [ "$key" = ctrl-o ]; then gh pr checkout "$num"; else gh pr view "$num" --web; fi; }
'
'''
